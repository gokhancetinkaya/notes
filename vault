export VAULT_ADDR="http://<vault/leader>:8200"

vault operator init | tee secrets/vault.txt

KEYS=$(grep "Unseal Key" secrets/vault.txt |awk {"print \$4"} |head -3)

for KEY in $KEYS; do vault operator unseal $KEY; done

export VAULT_TOKEN=$(grep "Initial Root Token" secrets/vault.txt | awk {"print \$4"})

vault token create -ttl=10m | tee secrets/vault-token.txt

TOKEN=$(grep token secrets/vault-token.txt | awk {"print \$2"} | head -1)

juju run vault/leader authorize-charm token=$TOKEN

juju run vault/leader generate-root-ca |tee vault-ca-cert.out
